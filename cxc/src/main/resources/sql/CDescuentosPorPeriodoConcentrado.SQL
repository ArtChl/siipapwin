SELECT TO_CHAR(A.FECHA,'MM/YYYY') AS PERIODO,A.SUCURSAL
,SUM(CASE WHEN A.SERIE<>'E' THEN ROUND(((-A.CANTIDAD-A.DEVOLUCIONES)*A.PRECIOLISTA),2) ELSE 0 END) AS CONTADO
,SUM(CASE WHEN A.SERIE='E' THEN ROUND(((-A.CANTIDAD-A.DEVOLUCIONES)*A.PRECIOLISTA),2) ELSE 0 END) AS CREDITO
,ROUND(SUM((-A.CANTIDAD-A.DEVOLUCIONES)*A.PRECIOLISTA),2) AS IMP_P_LIST
,ROUND(SUM((-A.CANTIDAD-A.DEVOLUCIONES)*A.PRECIOFACTURADO),2) AS IMP_FACT
,ROUND(SUM((((-A.CANTIDAD-A.DEVOLUCIONES)*A.PRECIOFACTURADO)*(100-A.DESCUENTO))/100),2) AS IMP_CON_DESCTO
,CASE WHEN SUM(-A.CANTIDAD-A.DEVOLUCIONES)=0 THEN 0 ELSE
ROUND(100-(SUM((((-A.CANTIDAD-A.DEVOLUCIONES)*A.PRECIOFACTURADO)*(100-A.DESCUENTO))/100)*100)/
SUM((-A.CANTIDAD-A.DEVOLUCIONES)*A.PRECIOLISTA),2)
END AS DESCTO
FROM V_VENTASDET A
JOIN SW_CLIENTES C ON(A.CLIENTE=C.CLAVE)
WHERE A.FECHA BETWEEN '01/01/2007' AND '31/01/2007'
GROUP BY A.SUCURSAL,TO_CHAR(A.FECHA,'MM/YYYY')